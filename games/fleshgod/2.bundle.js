(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{108:function(t,e,a){"use strict";a.r(e);var r=a(2),i=a.n(r),n=a(3),o=a.n(n),s=a(5),l=a.n(s),u=a(0),h=a.n(u),c=a(6),v=a(1),f=function(){function t(e){o()(this,t),this.alpha=1,this.z=0,this.bg="black",this.ctx=e,this.canvas=e.canvas}return l()(t,[{key:"_identity",value:function(){this.ctx.setTransform(1,0,0,1,0,0)}},{key:"setup",value:function(t){this.quads=new Map,this.textures={};var e=!0,a=!1,r=void 0;try{for(var n,o=t[Symbol.iterator]();!(e=(n=o.next()).done);e=!0)for(var s=n.value,l=Object.entries(s.rects),u=0;u<l.length;u++){var c=i()(l[u],2),f=c[0],d=c[1],p=d.pos,y=d.size;this.textures[f]={image:s.image,pos:v.a.apply(void 0,h()(p)),size:v.a.apply(void 0,h()(y))}}}catch(t){a=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(a)throw r}}}},{key:"drawUIQuad",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.textures[t],i=a.alpha,n=void 0===i?this.alpha:i,o=a.z,s=void 0===o?2:o,l=a.size,u=void 0===l?Object(v.a)(r.size.x,r.size.y):l,h=this.ctx;this.quads.set(s,this.quads.get(s)||[]),this.quads.get(s).push(function(){var t=h.globalAlpha;h.globalAlpha*=n,h.drawImage(r.image,r.pos.x,r.pos.y,r.size.x,r.size.y,e.x,e.y,u.x,u.y),h.globalAlpha=t})}},{key:"drawQuad",value:function(t,e){var a=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("empty"!==t){var i=this.textures[t],n=r.transforms,o=void 0===n?[]:n,s=r.size,l=void 0===s?Object(v.a)(i.size.x,i.size.y):s,u=r.z,c=void 0===u?this.z:u,f=r.program,d=void 0===f?{}:f,p=r.alpha,y=void 0===p?Object.prototype.hasOwnProperty.call(d,"alpha")?d.alpha:this.alpha:p,m=this.ctx;this.quads.set(c,this.quads.get(c)||[]),this.quads.get(c).push(function(){var t=m.globalAlpha;m.globalAlpha*=y,e=e.clone().subV2(a.camera),o.length&&(m.translate.apply(m,h()(e.clone().addV2(l.clone().mulScalar(.5)).array())),e=l.clone().mulScalar(-.5),o.forEach(function(t){return{rotate:function(){return m.rotate(t.angle)},flipX:function(){return m.scale(-1,1)},flipY:function(){return m.scale(1,-1)},scale:function(){return m.scale(t.x,t.y)}}[t.type||t]()})),m.drawImage(i.image,i.pos.x,i.pos.y,i.size.x,i.size.y,e.x,e.y,l.x,l.y),o.length&&a._identity(),m.globalAlpha=t})}}},{key:"measureText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.e,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.d;return this.ctx.font="".concat(e,"px ").concat(a),this.ctx.measureText(t)}},{key:"fillRect",value:function(t,e,a){var r=t.x,i=t.y,n=e.x,o=e.y,s=a.color,l=a.z,u=void 0===l?1:l,h=a.alpha,c=void 0===h?this.alpha:h,v=this.ctx;this.quads.set(u,this.quads.get(u)||[]),this.quads.get(u).push(function(){var t=v.globalAlpha;v.globalAlpha*=c,v.fillStyle=s,v.fillRect(r,i,n,o),v.globalAlpha=t})}},{key:"strokeRect",value:function(t,e,a){var r=t.x,i=t.y,n=e.x,o=e.y,s=a.color,l=a.z,u=void 0===l?1:l,h=a.alpha,c=void 0===h?this.alpha:h,v=this.ctx;this.quads.set(u,this.quads.get(u)||[]),this.quads.get(u).push(function(){var t=v.globalAlpha;v.globalAlpha*=c,v.strokeStyle=s,v.strokeRect(r,i,n,o),v.globalAlpha=t})}},{key:"fillPath",value:function(t,e){var a=e.color,r=e.z,i=void 0===r?1:r,n=this.ctx,o=this.alpha;this.quads.set(i,this.quads.get(i)||[]),this.quads.get(i).push(function(){var e=n.globalAlpha;n.globalAlpha*=o,t(),n.fillStyle=a,n.fill(),n.globalAlpha=e})}},{key:"drawText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.size,r=void 0===a?c.e:a,i=e.family,n=void 0===i?c.d:i,o=e.y,s=void 0===o?0:o,l=e.x,u=void 0===l?0:l,h=e.z,v=void 0===h?2:h,f=e.shadow,d=void 0===f||f,p=e.color,y=void 0===p?"white":p,m=this.ctx;this.quads.set(v,this.quads.get(v)||[]),this.quads.get(v).push(function(){m.font="".concat(r,"px ").concat(n),d&&(m.fillStyle="black",m.fillText(t,u+4,s+4)),m.font="".concat(r,"px ").concat(n),m.fillStyle=y,m.fillText(t,u,s)})}},{key:"drawTextCentered",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.size,r=void 0===a?c.e:a,i=e.family,n=void 0===i?c.d:i,o=e.y,s=void 0===o?0:o,l=e.x,u=void 0===l?0:l,h=e.z,v=void 0===h?2:h,f=this.measureText(t,r,n);this.drawText(t,{x:(this.canvas.width-f.width)/2+u,y:(this.canvas.height+r)/2+s,z:v,size:r})}},{key:"newFrame",value:function(t){var e=t.camera;this.camera=e,this._identity()}},{key:"endFrame",value:function(){var t=this.ctx;t.fillStyle=this.bg,t.fillRect(0,0,t.canvas.width,t.canvas.height);var e=h()(this.quads.keys());e.sort(function(t,e){return t-e});var a=!0,r=!1,i=void 0;try{for(var n,o=e[Symbol.iterator]();!(a=(n=o.next()).done);a=!0){var s=n.value,l=!0,u=!1,c=void 0;try{for(var v,f=this.quads.get(s)[Symbol.iterator]();!(l=(v=f.next()).done);l=!0)(0,v.value)()}catch(t){u=!0,c=t}finally{try{l||null==f.return||f.return()}finally{if(u)throw c}}}}catch(t){r=!0,i=t}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}this.quads.clear(),this.alpha=1,this.z=0}}]),t}(),d=a(13),p=a.n(d),y=a(32),m=g,b=function(){function t(e,a,r){o()(this,t),this.x=e,this.y=a,this.r=r}return l()(t,[{key:"clone",value:function(){return t(this.x,this.y,this.r)}},{key:"translate",value:function(t){var e=t.x,a=t.y;return this.ax+=e,this.ay+=a,this}},{key:"contains",value:function(t){return this.center.subV2(t).length()<this.r}},{key:"intersects",value:function(e){if(e instanceof M.class){var a=Object(v.a)(Math.max(e.x,Math.min(this.x,e.x+e.w)),Math.max(e.y,Math.min(this.y,e.y+e.h)));return this.contains(a)}return e instanceof t?e.center.subV2(this.center).length()<e.r+this.r:e.intersects(this)}},{key:"center",get:function(){return Object(v.a)(this.x,this.y)}},{key:"aabb",get:function(){return M(this.x-this.r,this.y-this.r,2*this.r,2*this.r)}}]),t}();function g(t,e,a){return new b(t,e,a)}g.class=b;var x=k,w=function(){function t(e,a,r,i){o()(this,t),this.ax=e,this.ay=a,this.bx=r,this.by=i}return l()(t,[{key:"clone",value:function(){return new t(this.ax,this.ay,this.bx,this.by)}},{key:"translate",value:function(t){var e=t.x,a=t.y;return this.ax+=e,this.ay+=a,this.bx+=e,this.by+=a,this}},{key:"scale",value:function(t){var e=t.x,a=t.y;return this.ax*=e,this.ay*=a,this.bx*=e,this.by*=a,this}},{key:"rotate",value:function(t){var e=this.a.rotate(t),a=this.b.rotate(t);return this.ax=e.x,this.ay=e.y,this.bx=a.x,this.by=a.y,this}},{key:"intersects",value:function(e){if(e instanceof t){var a=this.vector,r=a.angle,i=e.clone().translate(this.a.mulScalar(-1)).rotate(-r),n=i.by-i.ay,o=0===n?i.ax:i.ax-i.ay*((i.bx-i.ax)/n),s=Math.sign(i.ay);return(s!==Math.sign(i.by)||0===s)&&o>=0&&o<=a.length()&&Object(v.a)(o,0).rotate(r).addV2(this.a)}if(e instanceof m.class){var l=this.b.subV2(this.a),u=l.angle,h=e.center.subV2(this.a).rotate(-u),c=Math.abs(h.y);if(e.r<c)return!1;var f=Math.sqrt(e.r*e.r-c*c);return h.x+f>0&&l.length()>h.x-f}return e instanceof M.class?e.contains(this.a)||e.contains(this.b)||k.fromPoints(e.topLeft,e.topRight).intersects(this)||k.fromPoints(e.topRight,e.bottomRight).intersects(this)||k.fromPoints(e.bottomRight,e.bottomLeft).intersects(this)||k.fromPoints(e.bottomLeft,e.topLeft).intersects(this):e.intersects(this)}},{key:"a",get:function(){return Object(v.a)(this.ax,this.ay)}},{key:"b",get:function(){return Object(v.a)(this.bx,this.by)}},{key:"vector",get:function(){return this.b.subV2(this.a)}},{key:"aabb",get:function(){return M.fromPoints(Object(v.a)(Math.min(this.ax,this.bx),Math.min(this.ay,this.by)),Object(v.a)(Math.max(this.ax,this.bx),Math.max(this.ay,this.by)))}},{key:"midpoint",get:function(){return this.a.addV2(this.vector.mulScalar(.5))}}]),t}();function k(t,e,a,r){return new w(t,e,a,r)}k.fromPoints=function(t,e){return k(t.x,t.y,e.x,e.y)},k.class=w;var S=j,O=function(){function t(e){o()(this,t),this.points=e}return l()(t,[{key:"clone",value:function(){return new t(this.points.map(function(t){return t.clone()}))}},{key:"translate",value:function(t){var e=t.x,a=t.y,r=!0,i=!1,n=void 0;try{for(var o,s=this.points[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;l.x+=e,l.y+=a}}catch(t){i=!0,n=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw n}}}},{key:"rotate",value:function(t){var e=!0,a=!1,r=void 0;try{for(var i,n=this.points[Symbol.iterator]();!(e=(i=n.next()).done);e=!0)i.value.rotate(t)}catch(t){a=!0,r=t}finally{try{e||null==n.return||n.return()}finally{if(a)throw r}}}},{key:"scale",value:function(t){var e=t.x,a=t.y,r=!0,i=!1,n=void 0;try{for(var o,s=this.points[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;l.x*=e,l.y*=a}}catch(t){i=!0,n=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw n}}}},{key:"contains",value:function(t){for(var e=t.x,a=t.y,r=this.points,i=!1,n=r.length-1,o=0;o<r.length;o+=1){var s=r[n],l=r[o];l.y>a!=s.y>a&&e<l.x+(s.x-l.x)*(a-l.y)/(s.y-l.y)&&(i=!i),n=o}return i}},{key:"intersects",value:function(e){if(!this.points.length)return!1;var a=function(t){for(var e=[],a=t.points.length-1,r=0;r<t.points.length;r+=1){var i=t.points[a],n=t.points[r],o=i.clone().subV2(n).rotate90();e.push(o),a=r}return e},r=function(t,e){for(var a=t.points[0].dot(e),r=[a,a],i=1;i<t.points.length;i+=1)a=t.points[i].dot(e),r[0]=Math.min(a,r[0]),r[1]=Math.max(a,r[1]);return r},i=function(t,e,a){var i=r(t,a),n=r(e,a);return i[0]<n[1]&&i[1]>n[0]};if(e instanceof t){for(var n=h()(a(this)).concat(h()(a(e))),o=0;o<n.length;o++)if(!i(this,e,n[o]))return!1;return!0}if(e instanceof x.class){var s=j(e.a,e.b);if(!i(this,s,e.vector.rotate90()))return!1;for(var l=h()(a(this)),u=0;u<l.length;u++)if(!i(this,s,l[u]))return!1;return!0}if(e instanceof m.class){for(var c=this.points.length-1,f=[],d=!0,p=0;p<this.points.length;p+=1){var y=this.points[c],b=this.points[p].clone().subV2(y),g=e.center.subV2(y).dot(b),w=b.lengthSquared,k=Object(v.a)(g/w*b.x,g/w*b.y);if(g>=0&&g<=w?f.push(k.clone().addV2(y)):f.push(y.clone()),d){var S=b.clone().normalize().mulScalar(e.r),O=S.clone().reverse(),V=e.center.addV2(S).subV2(y).dot(b),T=e.center.addV2(O).subV2(y).dot(b);V<w&&T>0||(d=!1)}c=p}if(d)return!0;for(var E=0;E<f.length;E++)if(f[E].subV2(e.center).length()<e.r)return!0;return!1}return e instanceof M.class&&this.intersects(e.poly)}},{key:"lines",get:function(){var t=this;return this.points.map(function(e,a){return x.fromPoints(e,t.points[(a+1)%t.points.length])})}},{key:"aabb",get:function(){if(!this.points.length)return null;var t=this.points[0].clone(),e=this.points[0].clone(),a=!0,r=!1,i=void 0;try{for(var n,o=this.points.slice(1)[Symbol.iterator]();!(a=(n=o.next()).done);a=!0){var s=n.value;t.x=Math.min(t.x,s.x),t.y=Math.min(t.y,s.y),e.x=Math.max(e.x,s.x),e.y=Math.max(e.y,s.y)}}catch(t){r=!0,i=t}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return M.fromPoints(t,e)}},{key:"midpoint",get:function(){var t=Object(v.a)(),e=!0,a=!1,r=void 0;try{for(var i,n=this.points[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var o=i.value;t.addV2(o)}}catch(t){a=!0,r=t}finally{try{e||null==n.return||n.return()}finally{if(a)throw r}}return t.divScalar(this.points.length)}}]),t}();function j(){for(var t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];return new O(e)}j.class=O;var M=T;T.fromPoints=function(t,e){return T(t.x,t.y,e.x-t.x,e.y-t.y)},T.fromPointAndSize=function(t,e){return T(t.x,t.y,e.x,e.y)};var V=function(){function t(e,a,r,i){o()(this,t),this.x=e,this.y=a,this.w=r,this.h=i}return l()(t,[{key:"translate",value:function(t){var e=t.x,a=t.y;return this.x+=e,this.y+=a,this}},{key:"scale",value:function(t){var e=t.x,a=t.y;return this.x*=e,this.y*=a,this.w*=e,this.h*=a,this}},{key:"contains",value:function(t){return t.x>=this.x&&t.x<this.x+this.w&&t.y>=this.y&&t.y<this.y+this.h}},{key:"intersects",value:function(e){return e instanceof t?this.x<e.x+e.w&&this.x+this.w>e.x&&this.y<e.y+e.h&&this.y+this.h>e.y:e.intersects(this)}},{key:"rotated",value:function(t){return S(this.topLeft.rotate(t),this.topRight.rotate(t),this.bottomRight.rotate(t),this.bottomLeft.rotate(t))}},{key:"clone",value:function(){return T(this.x,this.y,this.w,this.h)}},{key:"topLeft",get:function(){return Object(v.a)(this.x,this.y)}},{key:"topRight",get:function(){return Object(v.a)(this.x+this.w,this.y)}},{key:"bottomLeft",get:function(){return Object(v.a)(this.x,this.y+this.h)}},{key:"bottomRight",get:function(){return Object(v.a)(this.x+this.w,this.y+this.h)}},{key:"midpoint",get:function(){var t=this.topLeft;return this.bottomRight.subV2(t).mulScalar(.5).addV2(t)}},{key:"size",get:function(){return Object(v.a)(this.w,this.h)}},{key:"poly",get:function(){return S(this.topLeft,this.topRight,this.bottomRight,this.bottomLeft)}}]),t}();function T(t,e,a,r){return new V(t,e,a,r)}T.class=V;var E=function(t){var e=t.type;return!c.g[e].particle&&!c.g[e].pickup},z=Object.freeze({player:E,bullet:E,enemy:E});function P(t,e){return z[t.type](e)}function A(t){var e=t.pos,a=t.type,r=t.scale,i=void 0===r?1:r,n=t.rot,o=c.g[a],s=o.size,l=o.radius,u=o.offset,h=void 0===u?Object(v.a)():u,f=o.hitbox;if(f)return f(t);if(s){var d=M.fromPointAndSize(e,s);if(1!==i||n){var p=e.clone().addV2(s.clone().mulScalar(.5)).addV2(h);d.translate(p.mulScalar(-1)),1!==i&&d.scale(Object(v.a)(i,i)),n&&(d=d.rotated(n)),d.translate(p.mulScalar(-1))}return d}return l?m(e.x,e.y,l*i).translate(h):S()}var L=function(t){return function(e,a){return void 0===a?t()*e:t()*(a-e)+e}},C=function(t){return function(e,a){return Math.floor(L(t)(e,a))}},R=I;function I(){return function(t){var e=0,a=0,r=0,i=1;0==t.length&&(t=[+new Date]);var n=function(){var t=4022871197,e=function(e){e=e.toString();for(var a=0;a<e.length;a++){var r=.02519603282416938*(t+=e.charCodeAt(a));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)};return e.version="Mash 0.9",e}();e=n(" "),a=n(" "),r=n(" ");for(var o=0;o<t.length;o++)(e-=n(t[o]))<0&&(e+=1),(a-=n(t[o]))<0&&(a+=1),(r-=n(t[o]))<0&&(r+=1);n=null;var s=function(){var t=2091639*e+2.3283064365386963e-10*i;return e=a,a=r,r=t-(i=0|t)};return s.uint32=function(){return 4294967296*s()},s.fract53=function(){return s()+1.1102230246251565e-16*(2097152*s()|0)},s.version="Alea 0.9",s.args=t,s.exportState=function(){return[e,a,r,i]},s.importState=function(t){e=+t[0]||0,a=+t[1]||0,r=+t[2]||0,i=+t[3]||0},s}(Array.prototype.slice.call(arguments))}I.importState=function(t){var e=new I;return e.importState(t),e};var N=a(7),q=Object.freeze(["left","right","up","down"]),D=function(){function t(){o()(this,t),this.clear()}return l()(t,[{key:"clear",value:function(){this.cells=new Map,this.sprites=new Map(Object.keys(c.g).map(function(t){return[t,[]]})),this.enemies=[],this.inactive=[],this.pickups=[]}},{key:"toJSON",value:function(t){var e={sprites:[],extra:t},a=new Set,r=function(t){var r=[t.initial.pos.x,t.initial.pos.y,t.type];a.add(t.type);var i=!0,n=!1,o=void 0;try{for(var s,l=(c.g[t.type].props||[])[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value;"dir"===u&&r.push(q.indexOf(t.initial[u]))}}catch(t){n=!0,o=t}finally{try{i||null==l.return||l.return()}finally{if(n)throw o}}e.sprites.push(r)},n=!0,o=!1,s=void 0;try{for(var l,u=this.enemies[Symbol.iterator]();!(n=(l=u.next()).done);n=!0)r(l.value)}catch(t){o=!0,s=t}finally{try{n||null==u.return||u.return()}finally{if(o)throw s}}var v=!0,f=!1,d=void 0;try{for(var p,y=this.pickups[Symbol.iterator]();!(v=(p=y.next()).done);v=!0)r(p.value)}catch(t){f=!0,d=t}finally{try{v||null==y.return||y.return()}finally{if(f)throw d}}var m=!0,b=!1,g=void 0;try{for(var x,w=this.sprites[Symbol.iterator]();!(m=(x=w.next()).done);m=!0){var k=i()(x.value,2),S=k[0],O=k[1];if(!c.g[S].particle&&!c.g[S].enemy&&!c.g[S].pickup){var j=!0,M=!1,V=void 0;try{for(var T,E=O[Symbol.iterator]();!(j=(T=E.next()).done);j=!0)r(T.value)}catch(t){M=!0,V=t}finally{try{j||null==E.return||E.return()}finally{if(M)throw V}}}}}catch(t){b=!0,g=t}finally{try{m||null==w.return||w.return()}finally{if(b)throw g}}e.types=h()(a);var z=!0,P=!1,A=void 0;try{for(var L,C=e.sprites[Symbol.iterator]();!(z=(L=C.next()).done);z=!0){var R=L.value;R[2]=e.types.indexOf(R[2])}}catch(t){P=!0,A=t}finally{try{z||null==C.return||C.return()}finally{if(P)throw A}}return e}},{key:"fromJSON",value:function(t){this.clear();var e=!0,a=!1,r=void 0;try{for(var i,n=t.sprites[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var o=i.value,s=this.createSprite(Object(v.a)(o[0],o[1]),t.types[o[2]]),l=3,u=!0,h=!1,f=void 0;try{for(var d,p=(c.g[s.type].props||[])[Symbol.iterator]();!(u=(d=p.next()).done);u=!0){var y=d.value;"dir"===y&&(s[y]=q[o[l]],s.initial[y]=s[y],l+=1)}}catch(t){h=!0,f=t}finally{try{u||null==p.return||p.return()}finally{if(h)throw f}}}}catch(t){a=!0,r=t}finally{try{e||null==n.return||n.return()}finally{if(a)throw r}}}},{key:"cell",value:function(t){var e=t.x,a=t.y;return this.cells.get("".concat(e>>c.b,",").concat(a>>c.b))}},{key:"deleteCell",value:function(t){var e=t.x,a=t.y;this.cells.delete("".concat(e>>c.b,",").concat(a>>c.b))}},{key:"cellCreate",value:function(t){var e=t.x,a=t.y,r="".concat(e>>c.b,",").concat(a>>c.b),i=this.cells.get(r);return i||(i={sprites:[],pos:Object(v.a)(e,a)},this.cells.set(r,i),i)}},{key:"spritesIn",value:function(e){var a=this,r=new Set;return t.shapeEach(e,function(t,i){var n=a.cell({x:t,y:i});if(n){var o=!0,s=!1,l=void 0;try{for(var u,h=n.sprites[Symbol.iterator]();!(o=(u=h.next()).done);o=!0){var c=u.value;A(c).intersects(e)&&r.add(c)}}catch(t){s=!0,l=t}finally{try{o||null==h.return||h.return()}finally{if(s)throw l}}}}),r}},{key:"linkSprite",value:function(e){var a=this;t.shapeEach(A(e),function(t,r){var i=a.cellCreate({x:t,y:r});e.cells.push(i),i.sprites.push(e)})}},{key:"unlinkSprite",value:function(t){var e=!0,a=!1,r=void 0;try{for(var i,n=t.cells[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var o=i.value;Object(N.c)(o.sprites,t),o.sprites.length||this.deleteCell(o.pos)}}catch(t){a=!0,r=t}finally{try{e||null==n.return||n.return()}finally{if(a)throw r}}t.cells=[]}},{key:"createSprite",value:function(t,e){var a={cells:[],pos:t,prev:t.clone(),initial:{pos:t.clone()},vel:Object(v.a)(),type:e};return this.linkSprite(a),this.sprites.get(e).push(a),c.g[e].enemy&&this.enemies.push(a),c.g[e].pickup&&this.pickups.push(a),a}},{key:"moveSprite",value:function(t,e){this.unlinkSprite(t),t.pos=e,this.linkSprite(t)}},{key:"deleteSprite",value:function(t){this.unlinkSprite(t),Object(N.c)(this.sprites.get(t.type),t)}},{key:"deactivateSprite",value:function(t){this.deleteSprite(t),this.resetSprite(t),this.inactive.push(t)}},{key:"activateSprite",value:function(t){Object(N.c)(this.inactive,t);var e=this.sprites.get(t.type);e.includes(t)||(e.push(t),this.linkSprite(t))}},{key:"resetSprite",value:function(t){t.vel=Object(v.a)();for(var e=Object.entries(t.initial),a=0;a<e.length;a++){var r=i()(e[a],2),n=r[0];r[1]instanceof v.a?t[n]=t.initial[n].clone():t[n]=t.initial[n]}}},{key:"respawn",value:function(){var t=!0,e=!1,a=void 0;try{for(var r,i=this.enemies[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var n=r.value;this.unlinkSprite(n),this.resetSprite(n),this.activateSprite(n)}}catch(t){e=!0,a=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw a}}}},{key:"player",value:function(){return(this.sprites.get("player")||[])[0]}}],[{key:"shapeEach",value:function(t,e){if(t instanceof m.class)for(var a=t.y-t.r&c.a;a<t.y+t.r;a+=c.c)for(var r=t.x-t.r&c.a;r<t.x+t.r;r+=c.c)e(r,a);else if(t instanceof M.class)for(var i=t.y&c.a;i<t.y+t.h;i+=c.c)for(var n=t.x&c.a;n<t.x+t.w;n+=c.c)e(n,i);else if(t instanceof S.class)for(var o=t.aabb,s=o.y&c.a;s<o.y+o.h;s+=c.c)for(var l=o.x&c.a;l<o.x+o.w;l+=c.c)t.intersects(M(l,s,c.c,c.c))&&e(l,s)}}]),t}();function Q(t,e){for(var a=Object.entries(e),r=0;r<a.length;r++){var n=i()(a[r],2)[1],o=n.pos,s=n.radius,l=n.size,u=n.angles;if(l){if(M.fromPointAndSize(o,l).contains(t))return n}else if(s){var h=o.clone().subV2(t);if(h.length()<s){if(!u)return n;var c=Math.atan2(h.x,h.y),v=i()(u,2),f=v[0],d=v[1];if(f<d){if(c>=f&&c<=d)return n}else if(c>=f||c<=d)return n}}}return null}var H=Object.freeze(new Set(["ControlLeft","AltLeft","ShiftLeft","MetaLeft","ControlRight","AltRight","ShiftRight","MetaRight","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"])),K=c.f.x,B=function(t){for(;t<=-Math.PI;)t+=2*Math.PI;for(;t>Math.PI;)t-=2*Math.PI;return t},F=function(){function t(e){var a=this,r=e.window,i=e.canvas,n=e.system,s=e.sounds,l=e.audio,u=e.config,h=e.ui;o()(this,t),this.ui=h,this.window=r,this.canvas=i,this.system=n,this.sounds=s,this.audio=l,this.config=u,this.soundChannels={},this.timer=0,this.board=new D,this.random=new R,this.camera=Object(v.a)(),this.cameraShake=0,this.globalTimer=0,this.highScore=3e3,this.showHitboxes=!1,this.keybinds=Object.freeze({KeyW:function(){return a.ymove.unshift(-1)},KeyD:function(){return a.xmove.unshift(1)},KeyS:function(){return a.ymove.unshift(1)},KeyA:function(){return a.xmove.unshift(-1)},Enter:function(){return a.pause()},Escape:function(){return a.quit()},Space:function(){return a.fire()},KeyQ:function(){return a.usePowerup()},KeyH:function(){return 0}}),this.keyups=Object.freeze({KeyW:function(){return Object(N.d)(a.ymove,-1)},KeyS:function(){return Object(N.d)(a.ymove,1)},KeyD:function(){return Object(N.d)(a.xmove,1)},KeyA:function(){return Object(N.d)(a.xmove,-1)},Space:function(){return a.stopFire()}}),this.touchButtons={},this.xmove=[],this.ymove=[],this.joyLook=Object(v.a)(),this.startTitle()}return l()(t,[{key:"load",value:function(t){this.initialBoard=t,this.board.fromJSON(t);var e=!0,a=!1,r=void 0;try{for(var n,o=this.board.sprites[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var s=i()(n.value,2)[1],l=!0,u=!1,h=void 0;try{for(var c,v=s[Symbol.iterator]();!(l=(c=v.next()).done);l=!0){var f=c.value,d=this.setupSprite(f);this.board.resetSprite(d)}}catch(t){u=!0,h=t}finally{try{l||null==v.return||v.return()}finally{if(u)throw h}}}}catch(t){a=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(a)throw r}}}},{key:"save",value:function(){return JSON.stringify(this.board.toJSON())}},{key:"quit",value:function(){this.startTitle()}},{key:"toggleHitboxes",value:function(){this.showHitboxes=!this.showHitboxes}},{key:"player",value:function(){return this.board.player()}},{key:"centerCamera",value:function(t){return t.clone().subV2(c.f.clone().mulScalar(.5))}},{key:"advancePlayer",value:function(){var t=this.board,e=t.player();if(!e)return e;e.invis>0&&(e.invis-=1);var a=Object(v.a)(this.joyMove.x||this.xmove[0]||0,this.joyMove.y||this.ymove[0]||0),r=a.length();if(r>1&&a.divScalar(r),a.mulScalar(e.speed),0===r)this.moving&&(this.moving=!1,this.slowTimer=11),e.vel.mulScalar(.875);else{this.moving||(this.moving=!0,this.playSound("thrust",{loop:!0,volume:.25}));var i={size:Object(v.a)(0,0),vel:a.clone().mulScalar(-1).rotate(L(this.random)(-.2,.2)),velVariance:1/8,counts:[1,2]};this.spawnParticles(p()({pos:e.pos.clone().addV2(Object(v.a)(-3,-4).rotate(e.rot))},i)),this.spawnParticles(p()({pos:e.pos.clone().addV2(Object(v.a)(-3,4).rotate(e.rot))},i)),e.vel.addV2(a.clone().mulScalar(1/8))}var n=e.vel.length();n>e.speed&&e.vel.divScalar(n).mulScalar(e.speed),t.moveSprite(e,e.pos.clone().addV2(e.vel));var o=h()(t.spritesIn(A(e))),s=o.filter(function(t){return t!==e&&P(e,t)}),l=!0,u=!1,c=void 0;try{for(var f,d=s[Symbol.iterator]();!(l=(f=d.next()).done);l=!0){var y=f.value;if(e.vel.x||e.vel.y){var m=A(y),b=e.pos.clone().subV2(m.center);e.vel=b.normalize().mulScalar(e.vel.length())}e.vel.addV2(y.vel.clone().mulScalar(8)),t.moveSprite(e,e.pos.clone().addV2(e.vel)),"meatball"===y.type?this.playSound("flesh"):this.playSound("metal"),0===e.invis&&("enemy"!==y.type&&"boss"!==y.type||this.damage(y),this.damage(e))}}catch(t){u=!0,c=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw c}}var g=o.filter(function(t){return"powerup"===t.type}),x=!0,w=!1,k=void 0;try{for(var S,O=g[Symbol.iterator]();!(x=(S=O.next()).done);x=!0){var j=S.value;this.collectPowerup(e,j)}}catch(t){w=!0,k=t}finally{try{x||null==O.return||O.return()}finally{if(w)throw k}}if(this.camera=this.centerCamera(e.pos),this.lookOffset&&(this.lookOffset.x||this.lookOffset.y)){this.camera.addV2(this.lookOffset);var M=e.rot;e.rot=this.lookOffset.angle,e.rvel=e.rot-M}if(this.firing&&0===this.firingTimer&&(this.playSound("shoot"),0!==e.weapon&&2!==e.weapon||this.createSprite(e.pos.clone().addV2(Object(v.a)(6,0).rotate(e.rot)),"bullet",{rot:e.rot,vel:Object(v.a)(5,0).rotate(e.rot),parent:e}),1===e.weapon||2===e.weapon)){var V=1===e.weapon?.05:.1;this.createSprite(e.pos.clone().addV2(Object(v.a)(4,-6).rotate(e.rot)),"bullet",{rot:e.rot,vel:Object(v.a)(5,0).rotate(e.rot-V),parent:e}),this.createSprite(e.pos.clone().addV2(Object(v.a)(4,6).rotate(e.rot)),"bullet",{rot:e.rot,vel:Object(v.a)(5,0).rotate(e.rot+V),parent:e})}return(this.firing||this.firingTimer)&&(this.firingTimer+=1,6===this.firingTimer&&(this.firingTimer=0)),this.lastPlayerPos=e.pos.clone(),e}},{key:"collectPowerup",value:function(t,e){0===t.powerMeter?t.weapon<2?t.powerMeter=1:t.speed<4?t.powerMeter=2:t.shield<2?t.powerMeter=3:t.powerMeter=4:1===t.powerMeter?t.speed<4?t.powerMeter=2:t.shield<2?t.powerMeter=3:t.powerMeter=4:2===t.powerMeter?t.shield<2?t.powerMeter=3:t.powerMeter=4:3===t.powerMeter&&(t.powerMeter=4),this.spawnParticles({pos:e.pos.clone().sub(8,9),size:Object(v.a)(13,16),velRange:Object(v.a)(1,1)}),this.playSound("powerup2"),this.deleteSprite(e)}},{key:"usePowerup",value:function(){var t=this.player();t&&0!==t.powerMeter&&(this.playSound("powerup1"),1===t.powerMeter?t.weapon+=1:2===t.powerMeter?t.speed+=.5:3===t.powerMeter?t.shield+=1:4===t.powerMeter&&(t.hp=12),t.powerMeter=0)}},{key:"spawnExplosion",value:function(t,e){var a=e.scale,r=void 0===a?1:a,i=e.volume,n=void 0===i?.5:i;return n>0&&this.playSound("explode".concat(C(this.random)(1,4)),{volume:n}),this.createSprite(t,"explosion",{scale:r})}},{key:"advanceBullet",value:function(t){var e=this.board,a=A(t);e.moveSprite(t,t.pos.clone().addV2(t.vel));var r=h()(e.spritesIn(a)),i=["enemy","boss","player"],n=r.find(function(e){return e!==t.parent&&i.includes(e.type)});n||r.some(function(e){return e!==t.parent&&P(t,e)})?(e.deleteSprite(t),n&&(this.damage(n),"player"===t.parent.type&&("boss"===n.type&&(n.anger+=1),0===n.hp?(t.parent.score+=c.g[n.type].value||0,this.highScore=Math.max(t.parent.score,this.highScore)):"boss"===n.type&&0===C(this.random)(0,64)&&(n.target=t.parent))),(!n||n.hp>0||"boss"===n.type)&&this.spawnExplosion(t.pos,{scale:L(this.random)(.25,.4)})):a.intersects(this.cameraRect)||e.deleteSprite(t)}},{key:"advanceEnemy",value:function(t){Object(N.b)([Object(v.a)(-1,0),Object(v.a)(1,0),Object(v.a)(0,-1),Object(v.a)(0,1),Object(v.a)(-1,-1),Object(v.a)(1,-1),Object(v.a)(-1,1),Object(v.a)(1,1)].map(function(t){return t.clone().mulScalar(c.c)}));var e=this.board,a=this.player();if(t.target||(t.target=a),!a&&t.target&&(t.target=null),t.target){var r=t.target.pos.clone().subV2(t.pos);r&&r.length()>=512&&(t.target=null)}if(h()(e.spritesIn(A(t))).filter(function(e){return e!==t&&P(t,e)}).length)this.deleteSprite(t);else{if(t.target){var i=t.target.pos.clone().subV2(t.pos),n=B(i.angle);if(t.rot=n,0===t.firingTimer){var o=t.pos.clone().subV2(this.lastPlayerPos).length();this.playSound("enemy-shoot",{volume:(K-o)/K*.5}),this.createSprite(t.pos.clone().addV2(Object(v.a)(4,-11).rotate(t.rot)),"bullet",{rot:t.rot,vel:Object(v.a)(4.5,0).rotate(t.rot),parent:t,skin:"enemy"})}if(8===t.firingTimer){var s=t.pos.clone().subV2(this.lastPlayerPos).length();this.playSound("enemy-shoot",{volume:(K-s)/K*.5}),this.createSprite(t.pos.clone().addV2(Object(v.a)(4,11).rotate(t.rot)),"bullet",{rot:t.rot,vel:Object(v.a)(4.5,0).rotate(t.rot),parent:t,skin:"enemy"})}}t.firingTimer+=1,16===t.firingTimer&&(t.firingTimer=0),null!==t.turnTarget&&Math.abs(t.rot-t.turnTarget)<.6&&(t.rot=t.turnTarget,t.rvel=0,t.turnTarget=null),t.rot=B(t.rvel+t.rot)}}},{key:"advanceBoss",value:function(t){var e=this,a=function(){var a=L(e.random)(0,2*Math.PI),r=Object(v.a)(0,C(e.random)(0,c.g.boss.radius)).rotate(a),i=t.pos.clone().addV2(r),n=L(e.random)(.75,1),o=e.spawnExplosion(i,{scale:n});return o.vel=r.divScalar(c.g.boss.radius/4),o};if(t.hp<=0){if(t.deathAnim>0&&(t.rot+=.2,t.deathAnim%4==0&&(a().vel=Object(v.a)()),t.deathAnim-=1),0===t.deathAnim){var r=!0,i=!1,n=void 0;try{for(var o,s=t.tail[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;this.deleteSprite(l)}}catch(t){i=!0,n=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw n}}this.deleteSprite(t);for(var u=0;u<16;u+=1)a();return}}else{var f=this.player(),d=1;t.target,t.target||(t.target=f);var p=t.target&&t.target.pos.clone().subV2(t.pos);if((!p||p.length()>=176+2*t.anger)&&(t.target=null),t.target&&t.target.hp<=0&&(t.target=null),t.target){d=Math.min(t.target.speed-.1,2.9);var y=p.angle+Math.PI/2,m=B(y-t.rot);Math.abs(m)>=.06?t.rvel=.06*Math.sign(m):(t.rvel=0,t.rot=y),t.turnTimer=0}else t.turnTimer||0!==C(this.random)(0,50)?t.turnTimer>0&&(t.turnTimer-=1):(t.rvel=.01*(2*C(this.random)(0,2)-1),t.turnTimer=C(this.random)(60,120)),0===t.turnTimer&&(t.rvel=0);t.rot+=t.rvel,t.vel=Object(v.a)(0,-d).rotate(t.rot),this.board.moveSprite(t,t.pos.clone().addV2(t.vel));var b=h()(this.board.spritesIn(A(t))).find(function(e){return e!==t&&"boss"===e.type});if(b){var g=t.pos.clone().subV2(b.pos),x=g.length(),w=2*c.g.boss.radius-x,k=g.divScalar(x).mulScalar(w);this.board.moveSprite(t,t.pos.clone().addV2(k))}}for(var S=t,O=0;O<t.tail.length;O+=1){var j=t.tail[O],M=S.pos.clone().subV2(j.pos);M.length()>=256-8*O?j.vel=M.normalize().mulScalar(t.vel.length()):j.vel=M.mulScalar(1/16),this.board.moveSprite(j,j.pos.clone().addV2(j.vel)),S=j}}},{key:"advancePowerup",value:function(t){var e=h()(this.board.spritesIn(A(t)));if(e.some(function(t){return"meatball"===t.type}))this.deleteSprite(t);else{t.anim+=1,90===t.anim&&(t.anim=0);var a=6*Math.sin(t.anim/90*Math.PI*2);t.pos.y=t.initial.pos.y+a,(e=h()(this.board.spritesIn(A(t)))).some(function(t){return"meatball"===t.type})&&(t.initial.pos.y-=a,t.pos.y-=a)}}},{key:"damage",value:function(t){if(!("player"===t.type&&t.invis>0&&t.hp>0)&&(t.hp-=1,"player"===t.type&&(t.invis=60*t.shield,this.cameraShake+=.25),t.hp<=0)){if("boss"===t.type)return void(0===t.deathAnim&&(t.deathAnim=180));var e={volume:.5,scale:.5};this.deleteSprite(t),"player"===t.type&&(e.volume=.75,e.scale=1,this.cameraShake+=.25,this.cameraDecel=t.vel.clone(),this.gameOverTimer=120,this.finalScore=t.score,(t.vel.x||t.vel.y)&&(this.slowTimer=11)),this.spawnExplosion(t.pos,e)}}},{key:"playSound",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.sounds[t];if(a){var r=e.volume,i=void 0===r?1:r;"music"===e.channel?e.volume=i*this.config.musicVolume:e.volume=i*this.config.sfxVolume,y.d(this,a,e)}if(e.channel){var n=this.soundChannels[e.channel];n&&y.c(n),a?this.soundChannels[e.channel]=a:delete this.soundChannels[e.channel]}}},{key:"stopSound",value:function(t){var e=this.sounds[t];e&&y.c(e)}},{key:"setSoundVolume",value:function(t,e){var a=this.sounds[t];a&&y.b(a,e)}},{key:"spawnParticles",value:function(t){for(var e=t.pos,a=t.size,r=t.vel,i=void 0===r?Object(v.a)(0,0):r,n=t.velRange,o=void 0===n?Object(v.a)(0,0):n,s=t.velVariance,l=void 0===s?0:s,u=t.counts,c=void 0===u?[8,15]:u,f=C(this.random).apply(void 0,h()(c)),d=[],p=0;p<f;p+=1){var y=this.random()*a.x,m=this.random()*a.y,b=1-l,g=[(i.x-o.x)*b,(i.x+o.x)/b],x=[(i.y-o.y)*b,(i.y+o.y)/b];i.x<0&&g.reverse(),i.y<0&&x.reverse(),d.push(this.createSprite(e.clone().add(y,m),"particle",{vel:Object(v.a)(L(this.random).apply(void 0,g),L(this.random).apply(void 0,x)),lifetime:24+L(this.random)(-6,6)}))}return d}},{key:"checkThrust",value:function(){this.slowTimer&&(this.slowTimer-=1,this.slowTimer>0?this.setSoundVolume("thrust",this.slowTimer/10*.125):this.stopSound("thrust"))}},{key:"advance",value:function(){var t=this.board,e=this.advancePlayer();this.checkThrust(),e||(this.cameraDecel&&(this.camera.addV2(this.cameraDecel),this.cameraDecel.mulScalar(.9375)),this.gameOverTimer>0&&(this.gameOverTimer-=1));var a=5*c.c;this.cameraRect=M(this.lastPlayerPos.x-a-this.canvas.width/2,this.lastPlayerPos.y-a-this.canvas.height/2,this.canvas.width+2*a,this.canvas.height+2*a);for(var r=this.cameraRect.topLeft.divScalar(128).map(function(t){return Math.floor(t)}),i=this.cameraRect.bottomRight.divScalar(128).map(function(t){return Math.ceil(t)}),n=r.y;n<i.y;n+=1)for(var o=r.x;o<i.x;o+=1){var s="".concat(o,",").concat(n);this.createdTiles.has(s)||(this.genTile(Object(v.a)(o,n)),this.createdTiles.add(s))}for(var l=0,u=0,f=h()(this.board.spritesIn(this.cameraRect)),d=0;d<f.length;d++){var p=f[d];if("enemy"===p.type){this.advanceEnemy(p);var y=p.pos.clone().subV2(this.lastPlayerPos).length();l=Math.max(l,K-y)}if("boss"===p.type){this.advanceBoss(p);var m=p.pos.clone().subV2(this.lastPlayerPos).length();u=Math.max(u,K-m)}"bullet"===p.type&&this.advanceBullet(p)}for(var b=h()(t.sprites.get("bullet")),g=0;g<b.length;g++){var x=b[g];A(x).intersects(this.cameraRect)||t.deleteSprite(x)}this.setSoundVolume("enemy",l/K*.15),this.setSoundVolume("boss",u/K*.35);for(var w=h()(t.sprites.get("powerup")),k=0;k<w.length;k++){var S=w[k];this.advancePowerup(S)}for(var O=["particle","explosion"],j=0;j<O.length;j++)for(var V=O[j],T=h()(t.sprites.get(V)),E=0;E<T.length;E++){var z=T[E];z.anim+=1,z.anim>=(z.lifetime||c.g[z.type].lifetime)?t.deleteSprite(z):z.pos.addV2(z.vel)}}},{key:"pause",value:function(){this.playSound("blip"),this.mode="pause",this.setSoundVolume("thrust",0),this.setSoundVolume("enemy",0),this.setSoundVolume("boss",0)}},{key:"startTitle",value:function(){this.cameraShake=0,this.timer=0,this.camera=Object(v.a)(),this.mode="title",this.sounds&&(this.stopSound("boss"),this.stopSound("enemy")),this.playSound("theme",{loop:!0})}},{key:"start",value:function(){this.playSound("blip"),this.mode="game",this.camera=Object(v.a)(),this.lookOffset=null,this.startTime=null,this.joyLook=Object(v.a)(),this.joyMove=Object(v.a)(),this.xmove=[],this.ymove=[],this.touches=new Map,this.timer=0,this.firing=!1,this.firingTimer=0;for(var t=Object.values(this.touchButtons),e=0;e<t.length;e++){var a=t[e];a.alpha=0,a.pressed=!1}this.board.clear(),this.createSprite(Object(v.a)(0,0),"player"),this.mapSeed=this.random(),this.createdTiles=new Set,this.stopSound("theme"),this.playSound("enemy",{loop:!0,volume:0}),this.playSound("boss",{loop:!0,volume:0})}},{key:"genTile",value:function(e){if(!(e.y<=1&&e.y>=-1&&e.x<=1&&e.x>=-1)){var a=t.whiteNoise(e.x,e.y,this.mapSeed,.54326),r=t.whiteNoise(e.x,e.y,this.mapSeed,.36142),i=e.clone().mulScalar(128).add(32*a,32*r),n=i.length(),o=50*(t.whiteNoise(e.x,e.y,this.mapSeed)+1);o>=90?this.createSprite(i,"meatball"):o>=80?this.createSprite(i,"meatball",{scale:.5}):o>=70?this.createSprite(i,"meatball",{scale:.25}):o>=65?this.createSprite(i,"powerup"):o>=55&&n>=512?this.createSprite(i,"enemy"):o>=54.5&&n>=2048&&this.createSprite(i,"boss")}}},{key:"mouseLook",value:function(t){var e=t.clientX,a=t.clientY;this.playerCameraLook(this.screenNormCoord(Object(v.a)(e,a)).subScalar(.5).mulScalar(2))}},{key:"playerCameraLook",value:function(t){if(this.player()){var e=c.f.clone().mulScalar(.25);this.lookOffset=t.mulV2(e)}}},{key:"stopFire",value:function(){this.firing=!1}},{key:"stopMouseLook",value:function(){this.stopFire()}},{key:"touchStart",value:function(t){for(var e=t.changedTouches,a=0;a<e.length;a+=1){var r=e.item(a),i=this.screenCoord(Object(v.a)(r.clientX,r.clientY));this.touches.set(r.identifier,r);var n=Q(i,this.touchButtons);n?(r.button=n,n.press(),n.pressed=!0,n.alpha=1):this.mouseLook(r)}}},{key:"touchMove",value:function(t){for(var e=t.changedTouches,a=0;a<e.length;a+=1){var r=e.item(a),i=this.touches.get(r.identifier);this.touches.set(r.identifier,r),i&&i.button?r.button=i.button:this.mouseLook(r)}}},{key:"touchEnd",value:function(t){for(var e=t.changedTouches,a=0,r=0;r<e.length;r+=1){var i=e.item(r),n=this.touches.get(i.identifier);this.touches.delete(i.identifier),n&&n.button?(n.button.release(),n.button.pressed=!1):a+=1}a&&h()(this.touches.values()).every(function(t){return t.button})&&this.stopMouseLook()}},{key:"fire",value:function(){this.firing=!0}},{key:"tickPlay",value:function(t){this.startTime||(this.startTime=this.window.performance.now());var e=!0,a=!1,r=void 0;try{for(var i,n=t[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var o=i.value;"keydown"===o.type?this.board.player()?(this.keybinds[o.code]||function(){})():0===this.gameOverTimer&&this.startTitle():"keyup"===o.type?(this.keyups[o.code]||function(){})():"mousedown"===o.type&&0===o.button?this.system.touchEnabled||this.fire():"mousedown"===o.type&&2===o.button?this.system.touchEnabled||this.usePowerup():"mouseup"===o.type&&0===o.button?this.system.touchEnabled||this.stopMouseLook():"mousemove"===o.type?this.system.touchEnabled||this.mouseLook(o):"mousemove"!==o.type||1&o.buttons?"movex"===o.type?this.joyMove.x=o.value:"movey"===o.type?this.joyMove.y=o.value:"lookx"===o.type?this.joyLook.x=o.value:"looky"===o.type?this.joyLook.y=o.value:"touchstart"===o.type&&o.changedTouches.length?this.touchStart(o):"touchmove"===o.type&&o.changedTouches.length?this.touchMove(o):"touchend"===o.type&&o.changedTouches.length&&this.touchEnd(o):this.system.touchEnabled||this.stopMouseLook()}}catch(t){a=!0,r=t}finally{try{e||null==n.return||n.return()}finally{if(a)throw r}}for(var s=Object.values(this.touchButtons),l=0;l<s.length;l++){var u=s[l];!u.pressed&&u.alpha>0&&(u.alpha-=1/8)}this.joyLook.length()>.01&&this.playerCameraLook(this.joyLook.clone()),"game"===this.mode&&this.advance()}},{key:"tickSound",value:function(){for(var t=this.config,e=this.soundChannels,a=Object.entries(e),r=0;r<a.length;r++){var n=i()(a[r],2),o=n[0],s=n[1],l="music"===o?t.musicVolume:t.sfxVolume;s.gainNode.gain.value=l}}},{key:"tick",value:function(){this.tickSound(),"pause"!==this.mode&&(this.globalTimer+=1),this.now=window.performance.now();var t=this.system.poll();if("title"===this.mode){this.timer+=1,this.timer>90&&(this.timer=0),this.random()<.025&&(this.cameraShake=c.h/1e3*2);var e=!0,a=!1,r=void 0;try{for(var i,n=t[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var o=i.value;("keydown"===o.type&&!H.has(o.code)||"mousedown"===o.type)&&this.start()}}catch(t){a=!0,r=t}finally{try{e||null==n.return||n.return()}finally{if(a)throw r}}}else if("game"===this.mode)this.tickPlay(t);else if("pause"===this.mode){var s=!0,l=!1,u=void 0;try{for(var h,v=t[Symbol.iterator]();!(s=(h=v.next()).done);s=!0){var f=h.value;"keydown"===f.type&&"Enter"===f.code&&(this.playSound("blip"),this.mode="game")}}catch(t){l=!0,u=t}finally{try{s||null==v.return||v.return()}finally{if(l)throw u}}}}},{key:"createSprite",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.board.createSprite(t.clone(),e);c.g[e].particle&&(r.anim=0);var i=!0,n=!1,o=void 0;try{for(var s,l=(c.g[e].props||[])[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value;r.initial[u]=a[u]}}catch(t){n=!0,o=t}finally{try{i||null==l.return||l.return()}finally{if(n)throw o}}return Object.assign(this.setupSprite(r),a)}},{key:"deleteSprite",value:function(t){this.board.deleteSprite(t)}},{key:"setupSprite",value:function(t){var e=c.g[t.type].setup,a=void 0===e?function(){}:e;return Object.assign(t,a(t,this))}},{key:"canvasRect",value:function(){var t=this.canvas.getBoundingClientRect(),e=t.top,a=t.left,r=t.width,i=t.height,n=this.canvas.width/this.canvas.height;return r/i>n?(a+=(r-i*n)/2,r=i*n):(e+=(i-r*(1/n))/2,i=r*(1/n)),{top:e,left:a,width:r,height:i}}},{key:"projectNormCoord",value:function(t){var e=this.canvasRect(),a=e.top,r=e.left,i=e.width,n=e.height;return t.clone().mul(i,n).add(r,a)}},{key:"projectCoord",value:function(t){return this.projectNormCoord(t.clone().div(this.canvas.width,this.canvas.height))}},{key:"screenNormCoord",value:function(t){var e=this.canvasRect(),a=e.top,r=e.left,i=e.width,n=e.height;return t.clone().sub(r,a).div(i,n)}},{key:"screenCoord",value:function(t){return this.screenNormCoord(t).mul(this.canvas.width,this.canvas.height)}},{key:"worldCoord",value:function(t){return this.screenCoord(t).addV2(this.camera)}}],[{key:"whiteNoise",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return 43758.5453*Math.sin(12.9898*t+78.233*e+17.3392*a+47.743*r)%1}}]),t}(),G=function(){function t(e){var a=e.game,r=e.system,i=e.now,n=e.config;o()(this,t),this.game=a,this.config=n,this.system=r,this.draw=new U(this),this.last=i,this.paused=!1}return l()(t,[{key:"frame",value:function(t,e){var a=this.draw,r=this.game;if("pause"!==r.mode||!this.paused){this.paused=!1;var i=null;r.cameraShake=Math.min(r.cameraShake,.5);var n=(i=(i="title"===r.mode?r.camera.clone():r.camera.clone().add(32*r.cameraShake*(2*Math.random()-1),32*r.cameraShake*(2*Math.random()-1))).map(function(t){return Math.round(t)})).clone().add(t.canvas.width,t.canvas.height);t.newFrame({camera:i}),a.start({ctx:t,camera:i,now:e});var o=c.f.y-32,s=function(e,a){var r=t.measureText(e,a.size||c.e).width;return a.x-=r/2,t.drawText(e,a),r};if("title"===r.mode){t.drawQuad("title",c.f.clone().subV2(t.textures.title.size).mulScalar(.5).sub(0,96),{alpha:.05*Math.sin(r.timer/90*Math.PI*2)+.9});for(var l=Object.freeze(["INSTRUCTIONS:","WASD - MOVE","MOUSE - AIM","SPACE/LEFTCLICK - FIRE","Q/RIGHTCLICK - APPLY SPAM","","EACH SPAM YOU COLLECT","ADVANCES YOUR POWER METER.","APPLY YOUR SPAM POWERS ONCE","YOUR POWER METER HAS REACHED","THE DESIRED LEVEL.","","CAN YOU DEFEAT THE FLESHGOD","AND CLAIM THE HIGH SCORE?"]),u=c.f.x/2-176,h=0;h<l.length;h+=1)t.drawText(l[h],{x:u,y:c.f.y/2+16*h,size:16})}else if("game"===r.mode||"pause"===r.mode){var f=function(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e/2,o=i.clone().mulScalar(e),s=o.clone().add(t.canvas.width,t.canvas.height),l=(o.y&c.a)-c.c;l<s.y+c.c;l+=c.c)for(var u=(o.x&c.a)-c.c;u<s.x+c.c;u+=c.c){var h=32*r.constructor.whiteNoise(u/2,l/2,.76383),f=32*r.constructor.whiteNoise(u/2,l/2,.63426),d=.5*r.constructor.whiteNoise(u/2,l/2,.42522)+.5;a.star({pos:Object(v.a)(u+h,l+f).subV2(o).addV2(i),alpha:2*(d*(e-n)+n),z:e,scale:.5})}};f(1/16),f(1/8),f(.25),f(.5);for(var d=new Set,p=(i.y&c.a)-c.c;p<n.y+c.c;p+=c.c)for(var y=(i.x&c.a)-c.c;y<n.x+c.c;y+=c.c){var m=this.game.board.cell({x:y,y:p});if(m){var b=!0,g=!1,x=void 0;try{for(var w,k=m.sprites[Symbol.iterator]();!(b=(w=k.next()).done);b=!0){var S=w.value;d.has(S)||(a.sprite(S),d.add(S))}}catch(t){g=!0,x=t}finally{try{b||null==k.return||k.return()}finally{if(g)throw x}}}}var O=r.player();if(O){s("1UP",{x:c.f.x-16-224,y:24,size:16,z:64}),s("".concat(O.score),{x:c.f.x-16-224,y:40,size:16,z:64});var j=[O.weapon<2?"WEAPON":null,O.speed<4?"SPEED":null,O.shield<2?"SHIELD":null,"HP"];this.powerMeterMeasure||(this.powerMeterMeasure=j.map(function(e){return e&&t.measureText(e,8)}));for(var M=0;M<j.length;M+=1){var V=j[M],T=Object(v.a)(16+48*M,o),E=M+1===O.powerMeter?1:1/8;if(t.strokeRect(T,Object(v.a)(48,16),{color:"#ffffff",alpha:E,z:64}),V){var z="rgba(255, 255, 255, ".concat(E);t.drawText(V,{x:T.x+(48-this.powerMeterMeasure[M].width)/2,y:T.y+12,size:8,z:64,shadow:!1,color:z})}}t.fillRect(Object(v.a)(c.f.x-32-128,o),Object(v.a)(O.hp/12*128,16),{color:"#ff0000",alpha:.8,z:64}),t.strokeRect(Object(v.a)(c.f.x-32-128,o),Object(v.a)(128,16),{color:"#ffffff",alpha:.8,z:64})}else r.gameOverTimer<60&&(t.drawTextCentered("GAME OVER",{z:64}),t.drawTextCentered("SCORE: ".concat(r.finalScore),{y:48,z:64}))}s("HIGH SCORE",{x:c.f.x-16-64,y:24,size:16,z:64}),s("".concat(r.highScore),{x:c.f.x-16-64,y:40,size:16,z:64}),"pause"===r.mode&&(t.drawTextCentered("PAUSE",{z:64}),this.paused=!0),t.endFrame({separation:new Float32Array(Array(6).fill().map(function(){return 32*r.cameraShake*(2*Math.random()-1)}))}),r.cameraShake=Math.max(0,r.cameraShake-(e-this.last)/1e3),this.last=e}}}]),t}(),U=function(){function t(e){var a=e.game;o()(this,t),this.game=a}return l()(t,[{key:"start",value:function(t){var e=t.ctx,a=t.camera,r=t.now;this.ctx=e,this.camera=a,this.now=r;var i=r%1e3/1e3,n=128+Math.floor(64*Math.sin(2*i*Math.PI)+64);this.selectShade=n.toString(16).padStart(2,"0"),this.dt=(this.now-this.game.now)/1e3/c.h}},{key:"sprite",value:function(t){this[t.type](t)}},{key:"rotatedQuad",value:function(t,e,a){var r=t.pos,i=t.vel,n=t.rot,o=t.rvel,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=r.clone().addV2(i.clone().mulScalar(this.dt)).subV2(a);this.ctx.drawQuad(e,l,p()({},s,{transforms:[{type:"rotate",angle:.5*Math.PI+n+o*this.dt}]}))}},{key:"player",value:function(t){this.rotatedQuad(t,"player",Object(v.a)(8,7),{alpha:t.invis>0?.25:1,z:1})}},{key:"enemy",value:function(t){this.rotatedQuad(t,"enemy",Object(v.a)(12,6))}},{key:"powerup",value:function(t){var e=t.pos,a=t.vel,r=e.clone().addV2(a.clone().mulScalar(this.dt)).sub(8,9);this.ctx.drawQuad("powerup",r)}},{key:"bullet",value:function(t){this.rotatedQuad(t,"".concat(t.skin,"-shot"),Object(v.a)(1,3))}},{key:"boss",value:function(t){var e=t.pos,a=t.vel,r=t.rot,i=t.rvel,n=e.clone().addV2(a.clone().mulScalar(this.dt));this.ctx.drawQuad("boss",n.clone().sub(63,63),{z:3});var o=r+i*this.dt;this.rotatedQuad({pos:n.clone().addV2(Object(v.a)(-24,-24).rotate(o)),vel:a,rot:r-Math.PI/2,rvel:i},"eyeball",Object(v.a)(13,13),{z:3.5}),this.rotatedQuad({pos:n.clone().addV2(Object(v.a)(24,-24).rotate(o)),vel:a,rot:r-Math.PI/2,rvel:i},"eyeball",Object(v.a)(13,13),{z:3.5})}},{key:"meatball",value:function(t){var e,a=t.pos,r=t.vel,i=t.scale,n=t.tail;e=i<=.25?"meatball-1":i<=.5?"meatball-2":"meatball-3";var o=c.g.meatball.radius*i,s=a.clone().addV2(r.clone().mulScalar(this.dt)).subScalar(o);i<=.25?i/=.25:i<=.5&&(i/=.5),this.ctx.drawQuad(e,s,{z:n?2-.01*n:4+1/1024*(s.y-this.camera.y),transforms:[{type:"scale",x:i,y:i}]})}},{key:"star",value:function(t){var e=t.pos,a=t.alpha,r=t.scale,i=e.clone().sub(1,1);this.ctx.drawQuad("particle",i,{alpha:a,z:0,transforms:[{type:"scale",x:r,y:r}]})}},{key:"particle",value:function(t){var e=t.pos,a=t.vel,r=t.anim,i=t.lifetime,n=1-(r+=this.dt)/i,o=e.clone().addV2(a.clone().mulScalar(this.dt)).sub(1,1);this.ctx.drawQuad("particle",o,{alpha:n,z:.9})}},{key:"explosion",value:function(t){var e=t.pos,a=t.anim,r=t.scale;a+=this.dt;var i=c.g.explosion,n=i.radius,o=i.lifetime;a<o&&this.ctx.drawQuad("explosion-".concat(Math.floor(a/(o/9))+1),e.clone().subScalar(n),{transforms:[{type:"scale",x:r,y:r}],z:3.6})}}]),t}(),Y=a(8),J=a(33),W=a.n(J);function _(t){var e=t.audio,a=t.config,r=t.window,i=t.canvas,n=t.gfx,o=t.sounds,s=t.ui,l=t.GLBackend,u=new Set,v=new X({window:r,bound:u,ui:s});v.setup(i,s);var d=new F({window:r,canvas:i,system:v,sounds:o,audio:e,config:a,ui:s});h()(Object.keys(d.keybinds)).forEach(function(t){return u.add(t)});var p=new G({game:d,system:v,config:a,now:r.performance.now()});Object.assign(s,{system:v,createBackend:function(t,e){if(l){var a=t.gl&&e.getContext("webgl",{depth:!1,alpha:!1,antialias:!1});if(a)return new l(a,t)}return new f(e.getContext("2d",{antialias:!1}))},save:function(){return W.a.setItem("fleshgodSettings",JSON.stringify(a)).catch(function(t){return Object(Y.a)(t)})},redraw:function(){var t=r.performance.now();p.frame(y,t)},reloadCanvas:function(){var t=i;(i=r.document.createElement("canvas")).width=t.width,i.height=t.height,i.id=t.id,v.setup(i,this),x(),d.canvas=i,t.parentElement.replaceChild(i,t),(y=this.createBackend(a,i)).setup(n),this.redraw()},project:function(t){return d.projectCoord(t)},reloadSound:function(){d.tickSound()}}),i.width=c.f.x,i.height=c.f.y;var y=s.createBackend(a,i);y.setup(n),s.resized();var m=function(t,e){return function(){return v.events.push({type:t,code:e})}},b=Object.freeze({axis0:function(t){var e=t.value;return v.events.push({type:"movex",value:e})},axis1:function(t){var e=t.value;return v.events.push({type:"movey",value:e})},axis2:function(t){var e=t.value;return v.events.push({type:"lookx",value:e})},axis3:function(t){var e=t.value;return v.events.push({type:"looky",value:e})},button12down:m("keydown","ArrowUp"),button13down:m("keydown","ArrowDown"),button14down:m("keydown","ArrowLeft"),button15down:m("keydown","ArrowRight"),button12up:m("keyup","ArrowUp"),button13up:m("keyup","ArrowDown"),button14up:m("keyup","ArrowLeft"),button15up:m("keyup","ArrowRight"),button0down:m("keydown","Space"),button1down:m("keydown","KeyQ"),button0up:m("keyup","Space"),button1up:m("keyup","KeyQ"),button9down:m("keydown","Enter")}),g=Object.freeze({"Vendor: 1d57 Product: 0020":{axis0:function(t){var e=t.value;return v.events.push({type:"movex",value:e})},axis1:function(t){var e=t.value;return v.events.push({type:"movey",value:e})},button1down:m("keyup","KeyQ"),button0down:m("keyup","Space")}}),x=function(){i.addEventListener("contextmenu",function(t){return t.preventDefault(),t.stopPropagation(),!1})};x(),setInterval(function(){s.blocking()?v.poll():(v.updateGamepads(b,g),d.tick())},c.h),function t(){s.blocking()||s.redraw(),r.requestAnimationFrame(t)}()}a.d(e,"default",function(){return _});var X=function(){function t(e){var a=this,r=e.window,i=e.bound,n=e.ui;o()(this,t),this.events=[],this.mousePos=Object(v.a)(NaN),this.window=r,this.padStates=new Map,this.padLastStates=new Map,this.padDeadZone=.5,this.touchEnabled=!1,r.addEventListener("resize",function(){return n.resized()}),r.addEventListener("mousemove",function(t){n.blocking()||(a.events.push(t),a.mousePos=Object(v.a)(t.clientX,t.clientY),a.mouseHover=t.target)}),r.addEventListener("mouseup",function(t){n.blocking()||a.events.push(t)}),r.addEventListener("touchend",function(t){a.touchEnabled=!0,n.blocking()||a.events.push(t)},{passive:!1}),r.addEventListener("touchmove",function(t){a.touchEnabled=!0,n.blocking()||(a.events.push(t),t.preventDefault(),t.stopPropagation())},{passive:!1}),r.document.body.addEventListener("keydown",function(t){n.blocking()||(t.repeat||a.events.push(t),i.has(a.constructor.keyCode(t))&&t.preventDefault())}),r.document.body.addEventListener("keyup",function(t){n.blocking()||(t.repeat||a.events.push(t),i.has(a.constructor.keyCode(t))&&t.preventDefault())})}return l()(t,null,[{key:"keyCode",value:function(t){return[t.altKey?"Alt_":"",t.ctrlKey?"Ctrl_":"",t.metaKey?"Meta_":"",t.code].join("")}}]),l()(t,[{key:"setup",value:function(t,e){var a=this;t.addEventListener("mousedown",function(t){e.blocking()||a.events.push(t)}),t.addEventListener("touchstart",function(t){a.touchEnabled=!0,e.blocking()||t.changedTouches.length&&a.events.push(t)},{passive:!1})}},{key:"updateGamepads",value:function(t,e){var a=this.window;if(a.navigator&&a.navigator.getGamepads){var r=h()(a.navigator.getGamepads()).filter(function(t){return t}),n=!0,o=!1,s=void 0;try{for(var l,u=r[Symbol.iterator]();!(n=(l=u.next()).done);n=!0){var c=l.value;if("standard"===c.mapping)this.tickGamepad(c,t);else for(var v=Object.entries(e),f=0;f<v.length;f++){var d=i()(v[f],2),p=d[0],y=d[1];if(c.id.match(new RegExp(p,"i"))){this.tickGamepad(c,y);break}}}}catch(t){o=!0,s=t}finally{try{n||null==u.return||u.return()}finally{if(o)throw s}}}}},{key:"tickGamepad",value:function(t,e){var a=this.padStates,r=this.padLastStates,i=a.get(t.id)||{};a.set(t.id,i);var n=Object.assign({},i);r.set(t.id,n),t.axes.forEach(function(t,e){return i["axis".concat(e)]=t}),t.buttons.forEach(function(t,e){var a=t.pressed;return i["button".concat(e)]=a});for(var o=Object.keys(i),s=0;s<o.length;s++){var l=o[s];if(i[l]!==n[l])if(l.match("button")){var u={type:"".concat(l).concat(i[l]?"down":"up")};(e[u.type]||function(){return 0})(u)}else if(l.match("axis")){var h=i[l],c=n[l],v=Math.abs(h)>=this.padDeadZone,f=Math.abs(c)>=this.padDeadZone;if(!f&&v){var d={type:l+(h>0?"+":"-")+"down"};(e[d.type]||function(){return 0})(d)}else if(f&&!v){var p={type:l+(c>0?"+":"-")+"up"};(e[p.type]||function(){return 0})(p)}else if(f&&v&&c>0!=h>0){var y={type:l+(c>0?"+":"-")+"up"};(e[y.type]||function(){return 0})(y);var m={type:l+(h>0?"+":"-")+"down"};(e[y.type]||function(){return 0})(m)}(e[l]||function(){return 0})({type:l,value:i[l]})}}}},{key:"poll",value:function(){return this.events.splice(0,this.events.length)}}]),t}()}}]);